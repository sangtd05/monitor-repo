name: Renovate

on:
    schedule:
        - cron: "0 2 * * *"
    workflow_dispatch:

jobs:
    renovate:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

            - name: Self-hosted Renovate
              uses: renovatebot/github-action@44f24283a60f64273f1294932f16ba61193cccca # v46.1.0
              with:
                  configurationFile: renovate.json
                  token: ${{ secrets.GITHUB_TOKEN }}
              env:
                  LOG_LEVEL: info
                  RENOVATE_REPOSITORIES: ${{ github.repository }}
                  RENOVATE_PLATFORM: github
                  RENOVATE_GIT_AUTHOR: "Renovate Bot <bot@renovateapp.com>"

    notify:
        runs-on: ubuntu-latest
        if: always() && needs.renovate.result == 'success'
        needs: renovate
        steps:
            - name: Send Telegram Notification
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_CHAT_ID }}
                  token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
                  format: markdown
                  message: |
                      ðŸ“¦ *Renovate Scan Completed*

                      *Repository:* `${{ github.repository }}`
                      *Trigger:* ${{ github.event_name }}

                      Check [Pull Requests](https://github.com/${{ github.repository }}/pulls?q=is:pr+is:open+author:app/renovate) created by Renovate.
