name: Renovate

on:
    schedule:
        - cron: "0 19 * * *"
    workflow_dispatch:
    pull_request:
        types: [opened, synchronize]

jobs:
    renovate:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

            - name: Self-hosted Renovate
              uses: renovatebot/github-action@44f24283a60f64273f1294932f16ba61193cccca # v46.1.0
              with:
                  configurationFile: renovate.json
                  token: ${{ secrets.GITHUB_TOKEN }}
              env:
                  LOG_LEVEL: info
                  RENOVATE_REPOSITORIES: ${{ github.repository }}
                  RENOVATE_PLATFORM: github
                  RENOVATE_GIT_AUTHOR: "Renovate Bot <bot@renovateapp.com>"

    notify:
        runs-on: ubuntu-latest
        if: github.event_name == 'pull_request' && startsWith(github.head_ref, 'renovate/')
        needs: renovate
        steps:
            - name: Send Telegram Notification
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_CHAT_ID }}
                  token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
                  format: markdown
                  message: |
                      ðŸ“¦ *Renovate Update - Monitor Stack*

                      *PR:* ${{ github.event.pull_request.title }}
                      *Repo:* `${{ github.repository }}`
                      *Branch:* `${{ github.head_ref }}`

                      [View Pull Request](${{ github.event.pull_request.html_url }})
