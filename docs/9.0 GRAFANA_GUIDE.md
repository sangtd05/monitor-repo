# ğŸš€ Grafana Configuration Guide

## ğŸ“‹ Tá»•ng quan

**Grafana** lÃ  giao diá»‡n trá»±c quan hÃ³a trung tÃ¢m (Single Pane of Glass). NÃ³ káº¿t ná»‘i Ä‘áº¿n táº¥t cáº£ datasource (Prometheus, Loki, Tempo, Mimir, Postgres) Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng tin.

---

## âš™ï¸ Cáº¥u hÃ¬nh (Provisioning)

ChÃºng ta sá»­ dá»¥ng **Provisioning** (Cáº¥u hÃ¬nh báº±ng File) thay vÃ¬ báº¥m chuá»™t trÃªn UI. Äiá»u nÃ y giÃºp cáº¥u hÃ¬nh khÃ´ng bá»‹ máº¥t khi restart container.

ThÆ° má»¥c chÃ­nh: `grafana-prometheus/grafana/provisioning/`

### 1. Datasources (`datasources/datasource.yml`)
Äá»‹nh nghÄ©a káº¿t ná»‘i Ä‘áº¿n cÃ¡c backend.

| TÃªn | Loáº¡i | URL | Má»¥c Ä‘Ã­ch |
|-----|------|-----|----------|
| **Prometheus** | prometheus | `http://prometheus:9090` | Metrics 24h & Alerting |
| **Mimir** | prometheus | `http://mimir:9009/prometheus` | Metrics dÃ i háº¡n (>1 nÄƒm) |
| **Loki** | loki | `http://loki:3100` | Logs |
| **Tempo** | tempo | `http://tempo:3200` | Traces |
| **Alertmanager** | alertmanager | `http://alertmanager:9093` | Quáº£n lÃ½ cáº£nh bÃ¡o |

**Best Practice**:
*   Sá»­ dá»¥ng biáº¿n mÃ´i trÆ°á»ng cho password/secret.
*   Set `isDefault: true` cho Prometheus.

### 2. Dashboards (`dashboards/dashboard.yml`)
Grafana tá»± Ä‘á»™ng load cÃ¡c file JSON tá»« thÆ° má»¥c `/etc/grafana/provisioning/dashboards/`.

**Cáº¥u trÃºc thÆ° má»¥c khuyáº¿n nghá»‹:**
```
dashboards/
â”œâ”€â”€ General/          # Overview, Hardware
â”œâ”€â”€ Database/         # Postgres, Mongo, Redis
â”œâ”€â”€ App/              # Services cá»¥ thá»ƒ
â””â”€â”€ Logs/             # Loki dedicated boards
```

### 3. Environment Variables (`docker-compose.yml`)

```yaml
environment:
  - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD} # Password admin
  - GF_USERS_ALLOW_SIGN_UP=false                   # Táº¯t Ä‘Äƒng kÃ½ tá»± do
  - GF_SERVER_ROOT_URL=https://monitor.domain.com  # URL public (cho Alert link)
  - GF_SMTP_ENABLED=true                           # Gá»­i email bÃ¡o cÃ¡o
```

---

## ğŸš€ HÆ°á»›ng dáº«n Váº­n hÃ nh

### 1. Import Dashboard má»›i
CÃ¡ch chuáº©n:
1.  TÃ¬m ID dashboard trÃªn [Grafana Labs](https://grafana.com/grafana/dashboards/).
2.  VÃ o UI -> Import -> Nháº­p ID.
3.  Test ok.
4.  **Save JSON**: Báº¥m nÃºt Save (icon Ä‘Ä©a má»m) -> "Download JSON".
5.  Copy file JSON vÃ o thÆ° má»¥c `provisioning/dashboards/` trong source code.
6.  Commit Git (Ä‘á»ƒ lÆ°u vÄ©nh viá»…n).

### 2. Quáº£n lÃ½ Playlist
Náº¿u cÃ³ mÃ n hÃ¬nh TV treo tÆ°á»ng:
*   Táº¡o Playlist chá»©a cÃ¡c Dashboard quan trá»ng (Overview, Alerts).
*   Set Auto-refresh 1 phÃºt.
*   Báº­t cháº¿ Ä‘á»™ Kiosk Mode (`d/xxxx?kiosk`).

### 3. Reset Password Admin
Náº¿u quÃªn máº­t kháº©u admin:
```bash
docker exec -it grafana grafana-cli admin reset-admin-password newpass123
```

---

## ğŸ”§ Troubleshooting

### "Datasource Error: Bad Gateway / Connection Refused"
*   **NguyÃªn nhÃ¢n**: Grafana container khÃ´ng nhÃ¬n tháº¥y container backend (Loki/Prometheus).
*   **Fix**:
    *   Kiá»ƒm tra tÃªn host trong URL datasource (pháº£i lÃ  service name trong docker-compose: `http://loki:3100`, khÃ´ng pháº£i `localhost`).
    *   Äáº£m báº£o chung network `monitoring`.

### Dashboard khÃ´ng load dá»¯ liá»‡u
*   Datasource cáº¥u hÃ¬nh sai tÃªn?
*   Time range chá»n quÃ¡ khá»© khÃ´ng cÃ³ data?
*   Query bá»‹ sai label? DÃ¹ng Explore Ä‘á»ƒ test query thÃ´ trÆ°á»›c.

---

## ğŸ“š TÃ i liá»‡u tham kháº£o
*   [Provisioning Grafana](https://grafana.com/docs/grafana/latest/administration/provisioning/)
*   [Dashboard Best Practices](https://grafana.com/docs/grafana/latest/dashboards/best-practices/)
