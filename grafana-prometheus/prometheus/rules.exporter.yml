groups:
  - name: exporter_alerts
    interval: 30s
    rules:
      - alert: ExporterDown
        expr: up{job=~".*exporter.*"} == 0
        for: 1m
        labels:
          severity: critical
          component: exporter
        annotations:
          summary: "Exporter {{ $labels.job }} is down"
          description: "Exporter {{ $labels.job }} (instance: {{ $labels.instance }}) has been down for more than 1 minute."

      - alert: ExporterScrapeError
        expr: up{job=~".*exporter.*"} == 0
        for: 2m
        labels:
          severity: warning
          component: exporter
        annotations:
          summary: "Exporter {{ $labels.job }} scrape error"
          description: "Failed to scrape metrics from {{ $labels.job }} (instance: {{ $labels.instance }}) for more than 2 minutes."

      - alert: MongoDBExporterConnectionError
        expr: mongodb_up == 0
        for: 2m
        labels:
          severity: critical
          component: mongodb_exporter
        annotations:
          summary: "MongoDB Exporter cannot connect to database"
          description: "MongoDB Exporter (instance: {{ $labels.instance }}) cannot connect to MongoDB for more than 2 minutes."

      - alert: PostgreSQLExporterConnectionError
        expr: pg_up == 0
        for: 2m
        labels:
          severity: critical
          component: postgres_exporter
        annotations:
          summary: "PostgreSQL Exporter cannot connect to database"
          description: "PostgreSQL Exporter (instance: {{ $labels.instance }}) cannot connect to PostgreSQL for more than 2 minutes."

      - alert: NodeExporterDown
        expr: up{job="node_exporter"} == 0
        for: 3m
        labels:
          severity: critical
          component: node_exporter
        annotations:
          summary: "Node Exporter is down on {{ $labels.instance }}"
          description: "Node Exporter on {{ $labels.instance }} has been down for more than 3 minutes."

      - alert: NginxExporterDown
        expr: up{job="nginx"} == 0
        for: 2m
        labels:
          severity: warning
          component: nginx_exporter
        annotations:
          summary: "Nginx Exporter is down"
          description: "Nginx Exporter (instance: {{ $labels.instance }}) has been down for more than 2 minutes."

      - alert: CAdvisorDown
        expr: up{job="cadvisor"} == 0
        for: 2m
        labels:
          severity: warning
          component: cadvisor
        annotations:
          summary: "cAdvisor is down"
          description: "cAdvisor (instance: {{ $labels.instance }}) has been down for more than 2 minutes."

      - alert: PromtailDown
        expr: up{job="promtail"} == 0
        for: 2m
        labels:
          severity: warning
          component: promtail
        annotations:
          summary: "Promtail is down"
          description: "Promtail (instance: {{ $labels.instance }}) has been down for more than 2 minutes. Log collection may be affected."

      - alert: LokiDown
        expr: up{job="loki"} == 0
        for: 2m
        labels:
          severity: critical
          component: loki
        annotations:
          summary: "Loki is down"
          description: "Loki (instance: {{ $labels.instance }}) has been down for more than 2 minutes. Log aggregation is not working."

      - alert: ExporterHighScrapeDuration
        expr: scrape_duration_seconds{job=~".*exporter.*"} > 10
        for: 5m
        labels:
          severity: warning
          component: exporter
        annotations:
          summary: "Exporter {{ $labels.job }} has high scrape duration"
          description: "Exporter {{ $labels.job }} (instance: {{ $labels.instance }}) has scrape duration of {{ $value }}s, which is higher than 10s."

      - alert: ExporterHighScrapeErrors
        expr: rate(prometheus_target_scrapes_exceeded_sample_limit_total{job=~".*exporter.*"}[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          component: exporter
        annotations:
          summary: "Exporter {{ $labels.job }} has high scrape errors"
          description: "Exporter {{ $labels.job }} (instance: {{ $labels.instance }}) has high rate of scrape errors."
